Bootstrap: docker
From : ubuntu:18.04
%labels
        quast.version 5.0.2
	KAT
        diamond Version v0.9.30
        Assemblytics 1.2
        bloobtools 1.1.1
        weesam
        modified by <aurore.comte@ird.fr>
%post
	apt-get update -y
	apt-get upgrade -y
	apt-get install -y build-essential sudo wget zlib1g-dev pkg-config libfreetype6-dev libpng-dev cmake

    export DEBIAN_FRONTEND=noninteractive
    ln -fs /usr/share/zoneinfo/Europe/Paris /etc/localtime
    apt-get install -y tzdata
    dpkg-reconfigure --frontend noninteractive tzdata

        apt-get install -y perl python3-all-dev python3-pip openjdk-8-jdk python-setuptools
        apt-get -y install curl file git gcc libtool libpthread-stubs0-dev
        apt-get -y install autoconf automake autotools-dev 
        apt-get -y install python3-dev python3-pip python3-tk
        apt -y install git-core   
        apt -y install r-base

        apt-get -y install bzip2 g++ libbz2-dev liblzma-dev libffi-dev libncurses5-dev libcurl4-gnutls-dev libssl-dev
        apt-get -y install gnuplot libcrypto++6

##### quast ####

    python3 -m pip install matplotlib

	wget -P /tmp/ https://downloads.sourceforge.net/project/quast/quast-5.0.2.tar.gz
	cd /tmp
	tar xvzf /tmp/quast-5.0.2.tar.gz
	rm /tmp/quast-5.0.2.tar.gz
	if [ -d "/quast" ]; then
		rm -rf /quast/
	fi
	mv /tmp/quast-5.0.2 /quast
	cd /quast/
	./install.sh
        cd ..

#### KAT #####

  python3 -m pip install sphinx

  wget https://github.com/TGAC/KAT/archive/Release-2.4.1.tar.gz
  tar -xzf Release-2.4.1.tar.gz
  cd KAT-Release-2.4.1
  ./build_boost.sh
  ./autogen.sh
  ./configure --disable-pykat
  make
  make install
  cd ..

##### DIAMOND ######

  cd /bin
  wget https://github.com/bbuchfink/diamond/releases/download/v0.9.30/diamond-linux64.tar.gz
  tar -xzf diamond-linux64.tar.gz
  cd ..

##### ASSEMBLYTICS ######

    wget https://github.com/MariaNattestad/Assemblytics/archive/v1.2.tar.gz
    tar -xvzf v1.2.tar.gz
    chmod a+x Assemblytics-1.2/scripts/Assemblytics*

    sed -i s/'env python'/'env python3'/ Assemblytics-1.2/scripts/Assemblytics_summary.py
    sed -i s/'env python'/'env python3'/ Assemblytics-1.2/scripts/Assemblytics_index.py
    sed -i s/'env python'/'env python3'/ Assemblytics-1.2/scripts/Assemblytics_within_alignment.py
    sed -i s/'env python'/'env python3'/ Assemblytics-1.2/scripts/Assemblytics_uniq_anchor.py

    python3 -m pip install numpy
    python3 -m pip install argparse

    Rscript -e 'install.packages(c("ggplot2","plyr","RColorBrewer","scales"))'

##### WEESAM #################

# minimap2 2.11
    wget https://github.com/lh3/minimap2/releases/download/v2.11/minimap2-2.11.tar.bz2
    tar xfvj minimap2-2.11.tar.bz2
    cd minimap2-2.11 && make
    cd ..

# samtools 1.9
    wget https://github.com/samtools/samtools/releases/download/1.9/samtools-1.9.tar.bz2
    tar xfvj samtools-1.9.tar.bz2
    cd samtools-1.9 
    ./configure
    make
    make install
    cd ..

    pip3 install cython
    python3 -m pip install argparse
    python3 -m pip install pysam
    python3 -m pip install statistics
    python3 -m pip install matplotlib
    python3 -m pip install seaborn
    python3 -m pip install numpy

    git clone https://github.com/centre-for-virus-research/weeSAM.git

##### BLOOBTOOLS #################

    pip3 install cython
    python3 -m pip install argparse
    python3 -m pip install pysam
    #python3 -m pip install statistics
    python3 -m pip install matplotlib
    python3 -m pip install seaborn
    python3 -m pip install numpy
    python3 -m pip install pyyaml
    python3 -m pip install tqdm
    python3 -m pip install docopt


# installation logiciel
    cd /usr/local
    #git clone https://github.com/DRL/blobtools.git
    wget https://github.com/DRL/blobtools/archive/blobtools_v1.1.1.tar.gz
    tar xzf blobtools_v1.1.1.tar.gz
    cd blobtools-blobtools_v1.1.1/

    wget ftp://ftp.ncbi.nlm.nih.gov/pub/taxonomy/taxdump.tar.gz -P data/
    tar zxf data/taxdump.tar.gz -C data/ nodes.dmp names.dmp
    ./blobtools nodesdb --nodes data/nodes.dmp --names data/names.dmp


%environment
    export PATH=$PATH:/quast:/bin:/Assemblytics-1.2/scripts/:/usr/local/blobtools-blobtools_v1.1.1:/weeSAM:/minimap2-2.11:/samtools-1.9

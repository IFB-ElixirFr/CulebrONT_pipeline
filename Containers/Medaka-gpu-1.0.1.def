
Bootstrap : docker
From : tensorflow/tensorflow:1.14.0-gpu-py3
%labels
    November 2019
    maintainer Aurore Comte <aurore.comte@ird.fr>
    medaka v1.0.1
#%help
%post
    apt-get -y update
    apt-get -y install bzip2 g++ zlib1g-dev libbz2-dev liblzma-dev libffi-dev libncurses5-dev libcurl4-gnutls-dev libssl-dev curl make cmake wget python3-all-dev python3-pip python-virtualenv
    apt-get -y install gnuplot build-essential perl autoconf autotools-dev libcrypto++6 curl
    apt-get -y install sudo git unzip git-lfs sed bash make
# installation logiciel

# samtools 1.9
    wget https://github.com/samtools/samtools/releases/download/1.9/samtools-1.9.tar.bz2
    tar xfvj samtools-1.9.tar.bz2
    cd samtools-1.9
    ./configure
    make
    make install
    cd ..

# tabix & BGzip 1.9 (htslib 1.10)
    wget https://github.com/samtools/htslib/releases/download/1.10/htslib-1.10.tar.bz2
    tar xfvj htslib-1.10.tar.bz2
    cd htslib-1.10
    ./configure
    make
    make install
    cd ..
# minimap2 2.11
    wget https://github.com/lh3/minimap2/releases/download/v2.11/minimap2-2.11.tar.bz2
    tar xfvj minimap2-2.11.tar.bz2
    cd minimap2-2.11 && make
    cd ..

# medaka 1.0.1
    python3 -m pip install medaka==1.0.1

    #pip install medaka
    #pip uninstall -y tensorflow
    #pip install tensorflow-gpu==1.14.0
%environment
    export PATH="/minimap2-2.11:/samtools-1.9:/htslib-1.10:${PATH}"

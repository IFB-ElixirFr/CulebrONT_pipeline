BootStrap: docker
From: ubuntu:18.04
%labels
Maintainer Julie Orjuela IRD
base.image="ubuntu:18.04"
version="1"
software="Raven"
software.version="1.1.10"
%help
URL: https://github.com/lbcb-sci/raven
Description: Raven is a de novo genome assembler for long uncorrected reads.
Usage: singularity exec $PATH_TO_CONTAINER/raven-1.1.10.simg + tools + arguments

%environment
    export PATH="/usr/local/miniconda/miniconda3/bin:$PATH"
    export PATH="/usr/local/miniconda/miniconda3/envs/raven/bin:$PATH"
    export CONDARC="/.condarc"
export LC_ALL=C

%post
    apt-get -y update
    apt-get -y install bzip2 g++ zlib1g-dev libbz2-dev liblzma-dev libffi-dev libncurses5-dev libcurl4-gnutls-dev libssl-dev curl make cmake wget python3-all-dev python3-pip python-virtualenv
    apt-get -y update
    apt-get -y install gnuplot build-essential perl autoconf autotools-dev libcrypto++6 curl
    apt-get -y update
    apt-get -y install sudo git unzip git-lfs sed bash make
    apt-get -y update

    apt update && apt install -y git curl wget less locate build-essential openssh-server
    mkdir /usr/local/miniconda && cd /usr/local/miniconda
    wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh
    chmod +x Miniconda3-latest-Linux-x86_64.sh
    ./Miniconda3-latest-Linux-x86_64.sh -b -p /usr/local/miniconda/miniconda3
    cd /usr/local/miniconda/miniconda3/bin
    export PATH="/usr/local/miniconda/miniconda3/bin:$PATH" >> $SINGULARITY_ENVIRONMENT
    conda config --add channels defaults
    conda config --add channels bioconda
    conda config --add channels conda-forge
    conda create -n raven -c conda-forge -c bioconda raven-assembler

%environment
    export PATH=${PATH}

%runscript
exec /bin/bash "$@"

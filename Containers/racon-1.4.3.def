BootStrap: docker
From: ubuntu:18.04

%labels
Maintainer Ndomassi Tando - IRD Itrop Cluster, DIADE Unit
base.image="ubuntu:18.04"
version="2"
software="racon"
software.version="1.4.3"

%help
URL: https://github.com/isovic/racon
Description: Racon is intended as a standalone consensus module to correct raw contigs generated by rapid assembly methods which do not include a consensus step. 
Launch the command: singularity run  /PATH_TO_CONTAINER/racon-1.4.3.simg +  arguments

%environment
export  PATH=$PATH:/usr/local/racon-1.4.3/build/bin
export  PATH=$PATH:/usr/local/bin

%post
apt update
apt install -y build-essential wget zlib1g-dev  cmake git curl


cd /usr/local
wget https://github.com/isovic/racon/releases/download/1.4.3/racon-v1.4.3.tar.gz
tar xvfz racon-v1.4.3.tar.gz
rm -rf racon-v1.4.3.tar.gz
mv racon-v1.4.3 racon-1.4.3
cd racon-1.4.3
mkdir build
cd build
cmake -DCMAKE_BUILD_TYPE=Release ..
make

# Compile minimap2
cd /opt
git clone https://github.com/lh3/minimap2
cd minimap2
git checkout v2.15  # Fix version
make
# Install executables and manpages
install minimap2 /usr/local/bin
install misc/paftools.js /usr/local/bin
install -m 644 minimap2.1 /usr/share/man/man1

# Install k8 runtime (for paftools.js)
curl -L https://github.com/attractivechaos/k8/releases/download/v0.2.4/k8-0.2.4.tar.bz2 | tar -jxf -
cd k8-0.2.4
mv k8-Linux k8
install k8 /usr/local/bin

%runscript
exec racon "$@"

Bootstrap : docker
From : ubuntu:18.04

%labels
    November 2019
    maintainer Aurore Comte <aurore.comte@ird.fr>
    Circlator v1.5.5 

#%help

%post
    apt-get -y update
    apt-get -y install sudo bzip2 g++ zlib1g-dev libbz2-dev liblzma-dev libffi-dev libncurses5-dev libcurl4-gnutls-dev libssl-dev curl make cmake wget python3-all-dev python3-pip python-virtualenv git git-lfs unzip gzip
    apt-get -y install zlib1g libssl-dev libcrypto++6 perl autoconf autotools-dev bash libncursesw5-dev gcc tar debconf locales
    apt-get -y install libgd-dev libcairo2-dev libpango1.0-dev
    apt-get -y install sed csh fig2dev gnuplot gnuplot-x11 xfig
    apt-get -y install libpng-dev libboost-all-dev libgsl0-dev default-jre tabix build-essential libcurl4-openssl-dev libxml2-dev
    apt-get -y install openjdk-8-jdk openjdk-8-jre

cat >> /etc/environment <<EOL
JAVA_HOME= /usr/lib/jvm/java-8-openjdk-amd64
JRE_HOME=/usr/lib/jvm/java-8-openjdk-amd64/jre
EOL

#locale-gen fr_FR.UTF-8
#dpkg-reconfigure locales

# BWA version >= 0.7.12
    wget https://github.com/lh3/bwa/archive/v0.7.17.zip
    unzip v0.7.17.zip
    cd bwa-0.7.17
    make
    bw=`pwd`
    cd ..

# prodigal version >= 2.6
    wget https://github.com/hyattpd/Prodigal/archive/v2.6.3.zip
    unzip v2.6.3.zip
    cd Prodigal-2.6.3
    make install
    pro=`pwd`
    cd ..

# SAMtools (versions 0.1.9 to 1.3)
    wget https://github.com/samtools/samtools/releases/download/1.3/samtools-1.3.tar.bz2 
    tar xfvj samtools-1.3.tar.bz2
    cd samtools-1.3
    ./configure
    make
    make install
    sam=`pwd`
    cd ..

# MUMmer version >= 3.23
    wget https://github.com/mummer4/mummer/releases/download/v4.0.0beta2/mummer-4.0.0beta2.tar.gz
    tar -zxvf mummer-4.0.0beta2.tar.gz
    cd mummer-4.0.0beta2
    ./configure
    make
    make install
    cd ..

# Canu (version 1.9)
    wget https://github.com/marbl/canu/archive/v1.9.tar.gz
    gunzip -dc v1.9.tar.gz | tar -xf -
    cd canu-1.9/src
    make -j 8
    cd ..
    can=`pwd`/Linux-amd64/bin
    cd ..

# SPAdes version 3.7.1
    wget http://cab.spbu.ru/files/release3.7.1/SPAdes-3.7.1.tar.gz
    tar -xzf SPAdes-3.7.1.tar.gz
    cd SPAdes-3.7.1
    ./spades_compile.sh
    spa=`pwd`
    cd ..
 
    PATH=$PATH:$bw:$spa:$pro:$mum:$sam:$can

# Circlator

    #setuptools:
    pip3 install setuptools==42.0.1 
    pip3 install cython
    pip3 install circlator==1.5.5

    #wget https://github.com/sanger-pathogens/circlator/archive/v1.5.6.zip
    #unzip v1.5.6.zip
    #cd circlator-1.5.6
    #python3 setup.py test
    #python3 setup.py install

%environment
    PATH="PATH=/bwa-0.7.17:/SPAdes-3.7.1:/Prodigal-2.6.3:/mummer-4.0.0beta2:/samtools-1.3:/canu-1.9/Linux-amd64/bin:${PATH}"
    export $PATH

#%runscript
#    exec circlator "$@"

